<!doctype html>
<html lang="zh-TW">
    <head>
        <meta charset="utf-8">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="csp-nonce" content="6a1f54a2-2922-4563-bf3c-230ffed9377f">
        
        
        <meta name="description" content="人工智慧與數位人文莊昊耘 2023.5.25">
        
        <title>Flask_TA - HackMD</title>
        <link rel="icon" type="image/png" href="https://hackmd.io/favicon.png">
        <link rel="apple-touch-icon" href="https://hackmd.io/apple-touch-icon.png">
        
<script nonce="6a1f54a2-2922-4563-bf3c-230ffed9377f">
  window.domain = 'hackmd.io'
  window.urlpath = ''
  window.debug = false
  window.version = '1.3.0'
  window.brand = 'HackMD'

  

  window.GOOGLE_API_KEY = 'AIzaSyCjSrqWHhmWJnoI7JlD88XDSaBgiKbaenA'
  window.GOOGLE_CLIENT_ID = '911617723593-drikdibvvn63slfd6kbqigo8ql1no55s.apps.googleusercontent.com'
  window.DROPBOX_APP_KEY = 'rdoizrlnkuha23r'
  
  window.PLANTUML_SERVER = 'https://ptuml.hackmd.io'

  window.ASSET_URL = 'https://assets.hackmd.io'

  window.USER_CAN_CREATE_TEAM = true
  window.USER_CAN_DELETE_ACCOUNT = true
  window.USER_DELETE_ACCOUNT_VIA_EMAIL = true
  window.PAYMENT_ENABLED = true
  window.PAYMENT_PROMOTION_BANNER_ENABLED = false
  window.GITHUB_SYNC_ENABLED = true
  window.GITLAB_SYNC_ENABLED = false
  window.GITLAB_SYNC_BASE_URL = ''
  window.VCS_SYNC_MODE = 'github'
  window.VCS_PROVIDER_NAME = 'GitHub'
  window.FREE_TEAM_NUM = 20
  window.FREE_TEAM_MEMBER_NUM = 3
  window.FREE_PUBLIC_TEAM_NUM = 10
  
  window.ALLOW_ANONYMOUS = true
  window.ALLOW_ANONYMOUS_EDIT = false
  window.PUBLIC_OVERVIEW = false
  window.INTERNAL_PUBLIC_OVERVIEW = false
  window.FULL_TEXT_SEARCH_ENABLE = false
  window.ALGOLIA_SEARCH_ENABLE = true
  window.MARKETING_EMAIL_ENABLE = true
  
  
  
  
    window.WALLET_CONNECT_PROJECT_ID = '91d6fa182b725b5895a17a170a5878c1'
  
  window.API_MANAGEMENT_UI_ENABLE = true
  window.FEEDBACK_UI_ENABLE = true
  window.PUBLISH_ENABLE = true

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  window.TRASH_NOTE_DELETE_AFTER_FREE = 3
  window.TRASH_NOTE_DELETE_AFTER_PAID = 30

  

  
    window.IS_OWNER_UPGRADED = false
  

  
    window.IMGUR_FALLBACK_CDN = 'https://imgur-backup.hackmd.io'
  

  
    window.CLOUD_META_UI = true
  
  
    window.CLOUD_META_API = true
  
  
    window.CLOUD_META_MIGRATION = false
  
  
    window.YAML_METADATA_ENABLED = false
  

  
    window.NOTE_CAPACITY_LIMIT = 50
  

  
    window.DOCUMENT_MAX_LENGTH = 100000
  

  
    window.SOCIAL_NETWORK_FEATURES_ENABLED = true
  

  
    window.PUBLISHMENT_MODERATION_ENABLED = true
  

  

  window.SUGGEST_EDIT_ENABLED = true
  

  
    window.REALTIME_CLIENT_WITH_CREDENTIALS = false
  

  
</script>


        
         <link href="https://assets.hackmd.io/build/font-vendor.85aea95458609ff85035.css" rel="stylesheet"><link href="https://assets.hackmd.io/build/common-vendor.8badda337754ab1de336.css" rel="stylesheet"><link href="https://assets.hackmd.io/build/slide-vendor.4f9ce891d775b406c282.css" rel="stylesheet"><link href="https://assets.hackmd.io/build/slide.70cc63e70cf401c79bf6.css" rel="stylesheet">

        <!-- style-loader will insert style before this div in development -->
        <!-- This prevents overwriting reveal.js theme css -->
        <meta id="style-tag-insertion">

        <!-- For reveal.js theme -->
        
        <link rel="stylesheet" href="https://assets.hackmd.io/build/reveal.js/dist/theme/white.css" id="theme">
        

        <!-- For overwrite reveal.js -->
        <link rel="stylesheet" href="https://hackmd.io/build/slide.css">

        <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js" integrity="sha256-3Jy/GbSLrg0o9y5Z5n1uw0qxZECH7C6OQpVBgNFYa0g=" crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/respond.js/1.4.2/respond.min.js" integrity="sha256-g6iAfvZp+nDQ2TdTR/VVKJf3bGro4ub5fvWSWVRi2NE=" crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/es5-shim/4.5.9/es5-shim.min.js" integrity="sha256-8E4Is26QH0bD52WoQpcB+R/tcWQtpzlCojrybUd7Mxo=" crossorigin="anonymous"></script>
<![endif]-->

    </head>
    <body>
        <div class="container" data-hard-breaks="true">
            <div class="reveal">
                <div class="slides" style="display: none;">

# Flask
&lt;font size=5&gt;

人工智慧與數位人文
莊昊耘 2023.5.25

&lt;font size=5&gt;

---

## 什麼是 Flask?

----

### 請大家到 `/templates` 打開 `static_index.html`

----

### Flask 就是幫助傳送網頁資料的工具

---

## Build my first Flask Web App

----

## :dart: 今日目標&lt;br&gt;&lt;br&gt;
**利用 Flask 打造 Machine Learning Web APP**

----

### 確認材料包
1. `flask_tutorial.ipynb`
2. `model_training.ipynb`
3. `flask_ml_app.ipynb`

----

### 打開 `flask_tutorial.ipynb`

----

## 安裝套件
```bash=
!pip install flask
```

----

### Flask...可以回傳單純文字
```python=
from flask import Flask
app = Flask(__name__)

@app.route(&#39;/&#39;) # ← Website url; try make a change.
def hello_world():
    return &#39;Hello, World!&#39;

# ↑ One page, one function; one change, one function.
```
```python=
app.run(port=5000)
# run app in debug mode on port 5000
```

----

![](https://i.imgur.com/mSwalXa.png)

----
    
### 每做一次更動就要按停止

----

## 既然可以傳送文字...

----

### 回傳 html
```python=
@app.route(&#39;/aidh&#39;)
def static_page():
    return &#39;&#39;&#39;
    &lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;Home Page - Microblog&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;h1&gt;Hello, this is a static webpage!&lt;/h1&gt;
    &lt;/body&gt;
    &lt;/html&gt;&#39;&#39;&#39;
```

----

![](https://i.imgur.com/jUaHvDT.png)

----

## 可是助教...

----

* 將上次的 html 檔複製進去 template 資料夾，重新命名為 `index.html`

----

### 直接回傳 html 檔
```python=
@app.route(&#39;/aidh_file&#39;)
def html_file_page():
    return render_template(&#39;index.html&#39;) # 檔案名稱
```
&lt;!-- 將名字那邊註解起來，要用的時候把它打開 --&gt;

----

![](https://i.imgur.com/7doeFG6.png)

----

### 你也可以新增變數

----

```python=
@app.route(&#39;/aidh_name&#39;)
def html_file_page_name():
    my_name = &#34;Milan&#34;
    return render_template(&#39;index.html&#39;, someone=my_name) # 檔案名稱
```
&lt;!-- 將名字那邊註解起來，要用的時候把它打開 --&gt;
```htmlembedded=
&lt;!-- @index.html --&gt;
&lt;h1&gt;我，{{someone}}，最喜歡張瑜芸老師了&lt;/h1&gt;
```

----

![](https://i.imgur.com/VV024xt.png)

----

### :dart: 小試身手

&lt;font size=6&gt;

1. 將 `index.html` 中新增一個`&lt;a&gt;`標籤
2. 標籤的文字部分輸入為「我的第一個 Web APP」並在標籤中加入超連結 (`&lt;a href=&#34;./&lt;route&gt;&#34;&gt;我的第一個 Web APP&lt;/a&gt;`)
3. 將超連結導向到 `static_index.html`
4. 在 `static_index.html` 新增 `&lt;h2&gt;` 標籤
5. 用以上加入參數的方法，在 `static_index.html` 中的 `&lt;h2&gt;` 標籤中加入文字「&lt;mark&gt;**[你的名字]**&lt;/mark&gt; 的第一個 Web APP」

&lt;font&gt;

----

![](https://i.imgur.com/9qraPFe.png)

----

![](https://i.imgur.com/QeAFdab.jpg)

---

## Post method

----

加入 `form.html` 的 body...
```htmlembedded=
&lt;!-- 對應 python 裡面的 result --&gt;
&lt;form method=&#34;POST&#34; action=&#34;/result&#34;&gt; 
        &lt;input type=&#34;text&#34; name=&#34;firstname&#34; placeholder=&#34;First name&#34;&gt;
        &lt;input type=&#34;text&#34; name=&#34;lastname&#34; placeholder=&#34;Last name&#34;&gt;
        &lt;button type=&#34;submit&#34; class=&#34;btn btn-primary&#34;&gt;SEND&lt;/button&gt;
&lt;/form&gt;
    {{ FIRSTNAME }}
    {{ LASTNAME }}
```

----

### 接收網頁傳送的值
```python=
app = Flask(__name__)
# default page of our web-app
@app.route(&#39;/&#39;)
def home():
    return render_template(&#39;form.html&#39;)

@app.route(&#39;/result&#39;, methods=[&#39;POST&#39;])
def result_intro():
    firstname = request.values[&#39;firstname&#39;]
    lastname = request.values[&#39;lastname&#39;]
    return render_template(&#39;form.html&#39;, FIRSTNAME=firstname, LASTNAME=lastname)
```

----

![](https://i.imgur.com/uNORTNp.png)

----

![](https://memeprod.ap-south-1.linodeobjects.com/user-template/b81fa7d87499a972b9cd55cbdd3cf716.png)

----

### 來看接收的值長什麼樣子
```python=
@app.route(&#39;/result&#39;, methods=[&#39;POST&#39;]) # route 對應 html 裡面的 action
def result():
    print(&#34;這是 request 印出來的樣子：&#34;, request)
    print(&#34;這是 request.values 印出來的樣子：&#34;, dict(request.values))
    print(&#34;這是 request.values 印出來的樣子：&#34;, list(request.values.keys()))
    print(&#34;這是 request.values 印出來的樣子：&#34;, list(request.values.values()))
    firstname = request.values[&#39;firstname&#39;]
    lastname = request.values[&#39;lastname&#39;]
    return render_template(&#39;form.html&#39;, FIRSTNAME=firstname, LASTNAME=lastname)
```

----

![](https://i.imgur.com/aJchFTe.png)

---

## Machine Learning APP
### Part 1: model training

----

* 機器學習模型只吃數值資料
* 用多少特徵訓練，也得用相同數量的特徵預測
* 注意轉成數值的資料對應的類別

----

### 打開 `model_training.ipynb`

----

```python=
from sklearn import svm
import pandas as pd
from sklearn.model_selection import train_test_split

df = pd.read_csv(&#39;./data/mammal_reptile.txt&#39;, sep=&#39;\t&#39;)
df.head()
```

----

```python=
from sklearn.preprocessing import LabelEncoder

le = LabelEncoder()
le_df = df.apply(le.fit_transform)
le_df = df.apply(LabelEncoder().fit_transform)
le_df.head()
```

----

```python=
features = le_df[[&#34;toothed&#34;,&#34;hair&#34;,&#34;breathes&#34;,&#34;legs&#34;]]
target = le_df[&#39;species&#39;]
```
```python=
feat_train, feat_test, target_train, target_test = train_test_split(features, target, test_size=0.2, random_state=0)
```
```python=
svm_model = svm.SVC(C=1, gamma=&#39;auto&#39;, kernel=&#39;rbf&#39;)
svm_model.fit(feat_train, target_train)
```
```python=
predicted_res = svm_model.predict(feat_test)
predicted_labels = le.inverse_transform(predicted_res)
predicted_labels
```

----

### 把模型存起來
```python=
import pickle
pickle.dump(svm_model, open(&#39;./model/svm_model.pkl&#39;,&#39;wb&#39;))
```

---

## Machine Learning APP
### Part 2: html

----

* 你的網站主題是什麼？功用是什麼？
* 希望使用者怎麼使用你的網站？
* 所有欄位都必填嗎？還是選填？
* 希望使用者輸入什麼格式？

----

### 複製 `static_index.html` &lt;br&gt;並命名為 `ml_app.html`

----

### 更改標題
```htmlembedded=5
&lt;title&gt;Mammal or not?&lt;/title&gt;
```
```htmlembedded=34
&lt;h1&gt;Guessing Mammals&lt;/h1&gt;
&lt;h3&gt;Give me features, I will guess if it&#39;s mammal or not.&lt;/h3&gt;
```

----

## 來看一下 `ml_app.html` 多了什麼吧！

----

### 在 html 中加入輸入欄位
```htmlembedded=
&lt;form action=&#34;/predict&#34; method=&#34;post&#34;&gt;
        &lt;input
          type=&#34;text&#34;
          name=&#34;toothed&#34;
          placeholder=&#34;Do they have tooth? Enter Yes or No.&#34;
          required=&#34;required&#34;
        /&gt;
```
----

## 還需要顯示結果吧！

----

### 讓網頁顯示 Flask 傳過來的文字
```htmlembedded=64
&lt;br /&gt;
&lt;br /&gt;
{{ prediction_text }}
```

---

## Machine Learning APP
### Part 3: Flask

----

* 需要什麼 method？ POST？
* function 數量 ＝ 頁面 (更動) 數量
* 初始頁面＋預測後顯示 (更動) ＝ 2
* 使用者想看到的是什麼？數字？文字？
* 如果使用者輸入錯誤格式怎麼辦？防呆機制？

----

### 搭建網站後端需要的 Flask
```python=
import pickle
app = Flask(__name__)
model = pickle.load(open(&#39;./model/svm_model.pkl&#39;, &#39;rb&#39;))
#default page of our web-app
@app.route(&#39;/&#39;)
def home():
    return render_template(&#39;ml_app.html&#39;)

#To use the predict button in our web-app
@app.route(&#39;/predict&#39;, methods=[&#39;POST&#39;])
def predict():
    &#39;&#39;&#39;
    For rendering results on HTML GUI
    &#39;&#39;&#39;
    try:
        int_features = []
        text_features = []
        for value in request.value.values():
            text_features.append(value)
        # text_features = [x for x in request.form.values()]
        for text in text_features:
            if text == &#34;Yes&#34;:
                int_features.append(1)
            elif text == &#34;No&#34;:
                int_features.append(0)
        final_features = [int_features]
        prediction = model.predict(final_features)
        if prediction[0] == 1:
            output = &#34;No&#34;
        elif prediction[0] == 0:
            output = &#34;Yes&#34;
        return render_template(&#39;ml_app.html&#39;, prediction_text=&#39;Is it a mammal? My answer is {}&#39;.format(output))
    except:
        return render_template(&#39;ml_app.html&#39;, prediction_text=&#39;Something went wrong with your input!&#39;)
```

----

```python=
app.run(port=8080)  # run app in debug mode on port 8080
```

----

![](https://i.imgur.com/vBweTrP.jpg)

---

## 今日目標

----

## 分工合作
&lt;font size=6&gt;

1. 使用 `iris.txt` 的資料訓練任一機器學習模型，並儲存。
2. 修改 ml_app.html，並依照資料加入適當數量的輸入欄位，使用者得輸入值進行預測。
3. 撰寫一Python Flask，以承接輸入欄位之資料，並以資料預測結果。

&lt;font&gt;

----

## :bulb: 加分
1. 明確的網站介紹與欄位輸入設計
2. 網站設計與美觀
3. 加入防呆機制

---

## 參考資料
&lt;font size=6&gt;

[Integrating Machine Learning into Web Applications with Flask](https://medium.com/analytics-vidhya/integrating-machine-learning-into-web-applications-with-flask-c345118cf08e)

&lt;font&gt;</div>
            </div>

            <div id="meta" style="display: none;">{&#34;metaMigratedAt&#34;:&#34;2023-06-18T04:30:34.208Z&#34;,&#34;metaMigratedFrom&#34;:&#34;YAML&#34;,&#34;title&#34;:&#34;Flask_TA&#34;,&#34;breaks&#34;:&#34;true&#34;,&#34;slideOptions&#34;:&#34;{\&#34;theme\&#34;:\&#34;white\&#34;,\&#34;spotlight\&#34;:{\&#34;enabled\&#34;:false},\&#34;transition\&#34;:\&#34;slide\&#34;,\&#34;slideNumber\&#34;:true}&#34;,&#34;description&#34;:&#34;人工智慧與數位人文莊昊耘 2023.5.25&#34;,&#34;contributors&#34;:&#34;[{\&#34;id\&#34;:\&#34;be042d37-8e4a-4b8c-b371-835cf33fe97b\&#34;,\&#34;add\&#34;:10677,\&#34;del\&#34;:3039}]&#34;}</div>

            
        </div>

        
         <script src="https://assets.hackmd.io/build/font-vendor.20350cc4e37635143259.js" defer="defer"></script><script src="https://assets.hackmd.io/build/common-vendor.f59a8489b8ce2d49b975.js" defer="defer"></script><script src="https://assets.hackmd.io/build/slide-vendor.860ac3abbcf53e23341c.js" defer="defer"></script><script src="https://assets.hackmd.io/build/slide-common.fb0162a2ceea4f101052.js" defer="defer"></script><script src="https://assets.hackmd.io/build/slide.bf33395fd9a69cf2903d.js" defer="defer"></script>
    </body>
</html>


